---
title: "canu"
author: "Roberto Canu"
format:
  html:
    code-fold: false
    message: false
    warning: false
editor: visual
---

```{r}
here::i_am("grades.Rproj")
library(here)
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(readr)
library(lubridate)
```
The link to the github repository is:[https://github.com/robertocanu/grades]


# INTRODUCTION

## Study organisation

### Question 1

```{r}
courses <- vroom(here("datafold", "courses.csv"))
```
## Question 2 

```{r}
courses |>
  arrange(course) |>
  knitr::kable()
```

## 1.2 Students 

### Question 3

```{r}
students <- read_delim(
  here("datafold", "students.csv"),
  col_types = cols(
    birth_date = col_date(),
    group = col_factor(),
    id = col_integer()
  )
)
```

The `birth_date` column of the `students` data frame is of class *`r class(students$birth_date)`*.

## 1.3 Grades 

### Question 4 
```{r}
grades <- read_delim(
  here("datafold", "grades.csv"),
  delim = ":",
  na = "_"
)
```
# Student Population analysis

### Question 5

```{r}
students |>
  summarise(n = n(), .by = group) |>
  ggplot(aes(x = as.integer(as.character(group)), y = n)) +
  geom_col() +
  labs(x = "Group", y = "Count")
```

### Question 6 
```{r}
students |>
  summarise(n = n(), .by = c(group, sex)) |>
  ggplot(aes(x = as.integer(as.character(group)), y = n, fill = sex)) +
  geom_col(position="fill") +
  labs(x = "Group", y = "Gender Balance")

```


### Question 7 
```{r}
students <- students |>
  mutate(age = time_length(today() - birth_date, unit = "year")) 

students |>
  ggplot(aes(x = age)) +
  geom_density(bw = "sj") +
  geom_rug(alpha = 0.1) +
  labs(x = "Age", y = "Density")
```

### Question 8 
```{r}
students |>
  summarise(median_age = round(median(age)), .by = group) |>
  arrange(as.integer(as.character(group))) |> 
  knitr::kable()
```

### Question 9 
```{r}
students |>
  slice_max(age, by = group) |>
  select(id, sex, age, group) |>
  arrange(desc(age)) |>
  knitr::kable()
```

# Simple grade analysis

### Question 10 
```{r}
ngrades <- grades |> 
  filter(!is.na(grade)) |> nrow()
```
The data set contains **`r ngrades`** grades.


### Question 11
```{r}
grades_courses <-
  left_join(grades, courses,
    by = join_by(course_id))

complete <- left_join(grades_courses, students,
                      by = join_by(id))

complete |>
  filter(course == "Art and Symbolism",
         !is.na(grade)) |>
  summarise(average_grade = mean(grade), .by = group) |>
  ggplot(aes(x = as.integer(as.character(group)), y = average_grade)) +
  geom_col(fill="darkblue") +
  labs(x = "Group",
       y = "Av. grade in Art and Symbolism")

```

### Question 12 
```{r}
complete |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = grade, fill = factor(semester))) + geom_density(bw = 1, alpha = 0.3) +
  labs(x = "Grade", y = "Density", fill = "Semester")
```

# Attendance analysis

### Question 13
```{r}
grades_per_student <-
  complete |>
  filter(!is.na(grade)) |>
  summarise(
    n_grades = n(),
    .by = c(id, group, sex)
  ) |>
  arrange(as.integer(as.character(id))) |>
  rename(
    `Student ID` = id,
    Group = group,
    Sex = sex,
    `Number of grades` = n_grades
  )


grades_per_student |>
  slice_head(n = 10) |>
  knitr::kable()
```

